import{validateEmail,validatePassword,showError,clearError}from"../helpers/formHelpers.js";import{togglePopup}from"../helpers/popupHelpers.js";const confirmPopup=document.querySelector(".confirm-popup"),signUpPopup=document.querySelector(".signUp-popup");export const tryLogin=async(o,e)=>{const r=btoa(`${o}:${e}`);try{const o=await fetch("https://api.dating.com/identity",{method:"GET",headers:{Authorization:`Basic ${r}`}});if(o.ok){const e=o.headers.get("X-Token");if(e)return localStorage.setItem("authToken",e),togglePopup(!1,signUpPopup),window.location.href=`https://www.dating.com/people/#token=${e}`,!0}}catch(o){console.error("Ошибка авторизации:",o)}return!1};export const registerUser=async o=>{const e=o.emailInput.value.trim(),r=o.passwordInput.value.trim();let t=!0;if(validateEmail(e)?clearError(o.emailInput,o.emailError):(showError(o.emailInput,o.emailError,"Please enter a valid e-mail"),t=!1),validatePassword(r)?clearError(o.passwordInput,o.passwordError):(showError(o.passwordInput,o.passwordError,"Password must be at least 8 characters long"),t=!1),!t)return;if(!await tryLogin(e,r))try{const o=await fetch("https://api.dating.com/identity",{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({email:e,password:r})}),t=await o.json();if(!o.ok)throw new Error(t.message||"Ошибка регистрации");const a=o.headers.get("X-Token");a?(togglePopup(!0,confirmPopup),localStorage.setItem("authToken",a),window.location.href=`https://www.dating.com/people/#token=${a}`):(togglePopup(!1,signUpPopup),togglePopup(!0,confirmPopup))}catch(o){console.error("Ошибка:",o.message),alert(o.message)}};